<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ceph S3 Presigned URL í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Pretendard, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }

        h1 {
            color: #333;
        }

        .box {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 6px #0001;
            margin-bottom: 2rem;
        }

        input[type="file"], input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #0066ff;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: #004ccc;
        }

        pre {
            background: #eee;
            padding: 1rem;
            border-radius: 8px;
            white-space: pre-wrap;
        }

        img {
            max-width: 100%;
            margin-top: 1rem;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<h1>ğŸ§© Ceph S3 Presigned URL í…ŒìŠ¤íŠ¸</h1>

<div class="box">
    <h2>1ï¸âƒ£ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
    <label>íŒŒì¼ ì„ íƒ:</label>
    <input type="file" id="uploadFile"/>

    <label>Presigned PUT URL:</label>
    <input type="text" id="uploadUrl" placeholder="Swaggerì—ì„œ ë°›ì€ presigned PUT URLì„ ì…ë ¥"/>

    <button onclick="uploadFile()">ì—…ë¡œë“œ ì‹¤í–‰</button>
    <pre id="uploadResult"></pre>
</div>

<div class="box">
    <h2>2ï¸âƒ£ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
    <label>Presigned GET URL:</label>
    <input type="text" id="downloadUrl" placeholder="ë‹¤ìš´ë¡œë“œìš© presigned GET URL ì…ë ¥"/>
    <button onclick="downloadFile()">ë‹¤ìš´ë¡œë“œ ì‹¤í–‰</button>
    <div id="downloadResult"></div>
</div>

<script>
    async function uploadFile() {
        const fileInput = document.getElementById("uploadFile");
        const uploadUrl = document.getElementById("uploadUrl").value.trim();
        const resultBox = document.getElementById("uploadResult");

        if (!fileInput.files.length) {
            alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");
            return;
        }
        if (!uploadUrl) {
            alert("Presigned URLì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        const file = fileInput.files[0];
        resultBox.textContent = "ì—…ë¡œë“œ ì¤‘...";

        try {
            const res = await fetch(uploadUrl, {
                method: "PUT",
                headers: {"Content-Type": file.type},
                body: file
            });

            if (res.ok) {
                resultBox.textContent = `âœ… ì—…ë¡œë“œ ì„±ê³µ! (HTTP ${res.status})\níŒŒì¼ MIME: ${file.type}\ní¬ê¸°: ${file.size} bytes`;
            } else {
                const text = await res.text();
                resultBox.textContent = `âŒ ì—…ë¡œë“œ ì‹¤íŒ¨ (HTTP ${res.status})\n\n${text}`;
            }
        } catch (err) {
            resultBox.textContent = `âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}`;
        }
    }

    async function downloadFile() {
        const url = document.getElementById("downloadUrl").value.trim();
        const result = document.getElementById("downloadResult");

        if (!url) {
            alert("ë‹¤ìš´ë¡œë“œ URLì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        result.innerHTML = "ë‹¤ìš´ë¡œë“œ ì¤‘...";
        try {
            const res = await fetch(url);
            if (!res.ok) {
                result.textContent = `âŒ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ (HTTP ${res.status})`;
                return;
            }

            const blob = await res.blob();
            const type = blob.type;
            const blobUrl = URL.createObjectURL(blob);

            if (type.startsWith("image/")) {
                result.innerHTML = `<p>âœ… ë‹¤ìš´ë¡œë“œ ì„±ê³µ!</p><img src="${blobUrl}" alt="ë‹¤ìš´ë¡œë“œ ì´ë¯¸ì§€" />`;
            } else {
                result.innerHTML = `<p>âœ… ë‹¤ìš´ë¡œë“œ ì„±ê³µ! (${type})</p><a href="${blobUrl}" download>ğŸ“¥ íŒŒì¼ ì €ì¥</a>`;
            }
        } catch (err) {
            result.textContent = `âš ï¸ ì˜¤ë¥˜: ${err.message}`;
        }
    }
</script>

</body>
</html>
